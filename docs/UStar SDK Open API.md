<div style="text-align: center; font-size: 36px; font-weight: bold">UStar SDK Interface Document</div>

<br/><br/>

# 0 Revision Records

> The interface document version corresponds to the version number of UStar

| SDK Version | Revision Time | Revised by | Revised Content                                      |
| ------- | -------- | ------ | ------------------------------------------------------------ |
| 2.5.0   | 20/10/2021  | Jingmu | 1.The original java version is organized into a general version<br />2.The face ID is added to the interface returned data for adding faces <br />3. Add attendance report interfaces <br />4. Interface optimization |
| 2.7.0   | 25/01/2022  | Jingmu   | 1. Add HTTPS description(#1.1) |
| 3.0.0.0   | 2022/03/02  | 井木   | 1. recognition call back field add<br/> 2.break time report list field update #4.14.3 <br/>3. update request header name to lower camel |
| 3.2.3.1   | 2022/03/02  | 井木   | 1. add person QR Code API #4.4.5 |

<br/><br/>

# 1 Request Explanation

## 1.1 Request Address

**Unified path: http://`127.0.0.1:9091`/develop/sdk/v1**

* `127.0.0.1:9091` Partially replace with the IP and port of UStar service
* HTTP and HTTPS ports are different
* Request method：`POST`
* Request header：`Content-Type: application/json;charset=UTF-8`

| Field Name       | Position | Type   | Required | Explanation                                                  |
| ---------------- | -------- | ------ | -------- | ------------------------------------------------------------ |
| sdkRequestKey  | header   | String | Y        | Request KEY                                                  |
| sdkAccessToken | header   | String | Y        | Token obtained from the Server                               |
| sdkSecretKey   | header   | String | Y        | AES KEY ciphertext encrypted by [RSA publicKe](#2)           |
| lang             | header   | String | Y        | Language types, please refer to [Dictionary 3.1](#3.1) for details |
| requestData      | body     | String | Y        | requestData is either encrypted or unencrypted, as described in the [requestData Specification](#requestData) |

* `sdkAccessToken`:  valid for one day and will not be valid after `UStar` is restarted
* `AES KEY`: AES KEY is generated by the developer itself and each request suggests a different KEY，the rule in
  the [AES](#2.2)

## 1.2 requestData Explanation<a id="requestData"></a>

### 1.2.1 Encrypted Interface

The parameter to the interface is the value of the json object requestData, namely

```json
   {
  "requestData": {
    "pageSize": 10,
    "empNo": "58693",
    "pageNum": 1
  }
}
```

The above json string is then encrypted with AES as the request body

 ```
 PK0AgL+Ws/TCzw2/PPzPhJnCgXqwb0ZddQ4o+EDGDhXhibTj2KXEqF2CXRKZ8OOgqZuktd1uvEHA
 0VBz9I8iZw==
 ```

Example of request body in Postman
![Postman body img1](C:\Users\jingmu\AppData\Roaming\Typora\typora-user-images/image1.png)

### 1.2.2 Unencrypted Interface

Unencrypted Interface: directly take the interface parameter as the value of the JSON object requestData

```json
  {
    "requestData": {
      "accessKey": "1dc8908e728b445d91c4d133ef40c92a",
      "accessSecret": "09555323806d4e809eee1617082ea6b1"
    }
  }
```

The above json string serves as a request body

Example of request body in Postman

![Postman body img2](C:\Users\jingmu\AppData\Roaming\Typora\typora-user-images/image2.png)

# 2 Secret Key<a id="2"></a>

> The Manager creates a new developer platform on the UStar developer access platform page
>
> The system will automatically generate `accessKey ` and `accessSecret`for the new platform, as well as `publicKey`
>
> `accessKey` and `accessSecret` are used for permission authentication to generate `sdkAccessToken`

## 2.1 RSA

The RSA `public key` and `private key` are generated by `UStar`, and then the RSA `public key` is obtained from the
docking platform page of `UStar`. The `public key` is used to encrypt and decrypt `AES keys`

## 2.2 AES <a id="2.2"></a>

* AES keys are generated by the developers themselves and use `128 bits`
* The offset `iv` is obtained from the `AES key`. The rule is: in the first step, reverse the `AES key` and take the
  first 16 characters

# 3 Data Dictionary

> Each dictionary data includes but not limited to the following dictionary items

## 3.1 Language<a id ="3.1"></a>

| Dictionary Item | Dictionary Value | Value Type | Explanation        |
| --------------- | ---------------- | ---------- | ------------------ |
| Chinese         | zh_CN            | String     | Simplified Chinese |
| English         | en               | String     | English            |
| French          | fr               | String     | Français           |
| Russian         | ru               | String     | русский язык       |
| Spanish         | es               | String     | Español            |

## 3.2 Gender<a id ="3.2"></a>

| Dictionary Item | Dictionary Value | Value Type | Explanation   |
| --------------- | ---------------- | ---------- | ------------- |
| Not filled in   | 0                | number     | not filled in |
| Male            | 1                | number     | Male          |
| Female          | 2                | number     | Female        |

## 3.3 Employee Permission Type<a id="3.3"></a>

| Dictionary Item      | Dictionary Value | Value Type | Explanation          |
| -------------------- | ---------------- | ---------- | -------------------- |
| Face Recognition     | 1                | number     | Face Recognition     |
| Card Recognition     | 2                | number     | Card Recognition     |
| Face-card-in-one     | 3                | number     | Face-card-in-one     |
| Face-card comparison | 4                | number     | Face-card comparison |

## 3.4 Event Type

| Dictionary Item          | Dictionary Value | Value Type | Explanation              |
| ------------------------ | ---------------- | ---------- | ------------------------ |
| Recognition record event | 1                | number     | Recognition record event |
| Employee add event       | 2                | number     | Employee add event       |
| Employee update event    | 3                | number     | Employee update event    |
| Employee delete event    | 4                | number     | Employee delete event    |
| Department add event     | 5                | number     | Department add event     |
| Department update event  | 6                | number     | Department update event  |
| Department delete event  | 7                | number     | Department delete event  |

## 3.5 Attendance Date Type<a id="3.5"></a>

| Dictionary Item                  | Dictionary Value | Value Type | Explanation                      |
| -------------------------------- | ---------------- | ---------- | -------------------------------- |
| Working day (normal timetable)   | 1                | number     | Working day (normal timetable)   |
| Working day (flexible timetable) | 2                | number     | Working day (flexible timetable) |
| Weekend                          | 3                | number     | Weekend                          |
| Holiday                          | 4                | number     | Holiday                          |
| Not scheduled                    | 5                | number     | Not scheduled                    |

## 3.6 Device Status<a id="3.6"></a>

| Dictionary Item       | Dictionary Value | Value Type | Explanation           |
| --------------------- | ---------------- | ---------- | --------------------- |
| Device offline        | 0                | number     | Device offline        |
| Device Online         | 1                | number     | Device Online         |
| Device disabled       | 2                | number     | Device disabled       |
| Device password error | 3                | number     | Device password error |

# 4 SDK Interface

## 4.1  Interface Response Explanation

> In ResponseHeader: `Content-Type: application/json;charset=UTF-8`

### 4.1.1 Unified Result Return Field<a id="4.1.1"></a>

| Field Name | Field Type | Explanation                                                  |
| :--------- | :--------- | :----------------------------------------------------------- |
| code       | String     | Return the code of the parameter, `1000_sus` indicates success, others indicate failure. |
| success    | boolean    | `true` indicates success, and `false` indicates failure      |
| msg        | String     | `successful operation!`  or `operation failed!`              |
| data       | Object     | AES encrypted string of the data returned by each request    |
| secret     | String     | The AES KEY ciphertext encrypted by RSA private key (decryption with public key is required) |

**Note：**

* **If the interface in 4.2 does not return data, the data field of the actual interface is `None`.**
* **If the field name of the interface in 4.2 is None, the returned data is the content of the data field.**

### 4.1.2 Result Return Field in Paging

> The following fields are the data of the Data Field in the public response field.

| Field Name | Field Type      | Explanation                                                  |
| ---------- | --------------- | ------------------------------------------------------------ |
| pageNum    | number(integer) | Page number                                                  |
| pageSize   | number(integer) | Number of paging data                                        |
| pages      | number(integer) | Total page number                                            |
| total      | number(long)    | Total data number                                            |
| list       | array(list)     | Data array java list The data of paging query interface is actually the content of the list. |

## 4.2 Test Interface

### 4.2.1 Test Interface

* sdkRequestKey : `test`

* Request parameter explanation：no request parameter

* Response parameter explanation：

  | Field Name | Field Type | Explanation                               |
  | ---------- | ---------- | ----------------------------------------- |
  | None       | String     | Hello, this is the offline client service |

## 4.3 Authentication API

### 4.3.1 Obtain sdkAccessToken

* sdkRequestKey : `authToken`

* Request parameter explanation

  | Field Name   | Field Type | Required | Explanation                                       |
  | ------------ | ---------- | -------- | ------------------------------------------------- |
  | accessKey    | String     | Y        | Developer accesses to the platform page to obtain |
  | accessSecret | String     | Y        | Developer accesses to the platform page to obtain |

  > the request need not secreted
   ```json
   {
       "requestData":{
           "accessKey":"1dc8908e728b445dxxxxxxxxx",
           "accessSecret":"09555323806d4exxxxxxxxxxxxxx"
       }
   }
   ```
* Response parameter explanation

  | Field Name | Field Type | Explanation                                                  |
  | ---------- | ---------- | ------------------------------------------------------------ |
  | None       | String     | The returned string is the credential that requests other interface and is placed in the request header `SDK _ACCESS_TOKEN` |

  > **Note: token is not encrypted and is valid for 1 day. After USTAR is restarted, it will be invalid.**

## 4.4 Personnel API

### 4.4.1 Add Personnel

* sdkRequestKey : `addPerson`

* Request parameter explanation

  | Field Name   | Field Type    | Required | Explanation                                                  |
  | ------------ | ------------- | -------- | ------------------------------------------------------------ |
  | empNo        | String        | Y        | Employee No, unique value, only letters and numbers, length 32 |
  | name         | String        | Y        | Developer accesses to the platform page to obtain            |
  | phone        | String        | N        | Phone number                                                 |
  | mail         | String        | N        | E-mail                                                       |
  | stageName    | String        | N        | Stage name                                                   |
  | cardNo       | String        | N        | IC card number                                               |
  | entryTime    | String        | N        | Entry time: yyyy-MM-dd HH:mm:ss format                       |
  | workPlace    | String        | N        | Working place                                                |
  | personTypeId | String        | N        | Employee type ID                                             |
  | tel          | String        | N        | Landline                                                     |
  | gender       | number(byte)  | N        | Gender，dictionary [3.2](#3.2)                               |
  | idCardNo     | String        | N        | ID card number                                               |
  | roleId       | String        | N        | Role ID                                                      |
  | deptIdList   | array(string) | N        | Department collection ID list                                |

* Response parameter explanation

  | Field Name | Field Type | Explanation                  |
  | ---------- | ---------- | ---------------------------- |
  | 无         | String     | Employee id, not Employee No |

### 4.4.2 Update Personnel

* sdkRequestKey : `updatePerson`

* Request parameter explanation

  | Field Name   | Field Type    | Required | Explanation                                                  |
  | ------------ | ------------- | -------- | ------------------------------------------------------------ |
  | empNo        | String        | Y        | Employee No, unique value, only letters and numbers, length 32 |
  | name         | String        | Y        | Developer accesses platform page to obtain                   |
  | phone        | String        | N        | Phone number                                                 |
  | mail         | String        | N        | E-mail                                                       |
  | stageName    | String        | N        | Stage name                                                   |
  | cardNo       | String        | N        | IC card number                                               |
  | entryTime    | String        | N        | Entry time: yyyy-MM-dd HH:mm:ss format                       |
  | workPlace    | String        | N        | Working place                                                |
  | personTypeId | String        | N        | Employee type ID                                             |
  | tel          | String        | N        | Landline                                                     |
  | gender       | number(byte)  | N        | Gender，dictionary [3.2](#3.2)                               |
  | idCardNo     | String        | N        | ID card number                                               |
  | roleId       | String        | N        | Role ID                                                      |
  | deptIdList   | array(string) | N        | Department collection ID list                                |
  | qrCodeId   | String | N        | QR Code ID, the 4.4.5 API response                     |
  
* Response parameter explanation: None

### 4.4.3 Query Personnel in Paging

* sdkRequestKey : `queryPersonPage`

* Request parameter explanation

  | Field Name | Field Type    | Required | Explanation                       |
  | ---------- | ------------- | -------- | --------------------------------- |
  | empNo      | String        | Y        | Employee No                       |
  | name       | String        | Y        | Employee name, full-word matching |
  | deptIdList | array(string) | N        | Department array ID list          |

* Response parameter explanation

  | Field Name   | Field Type    | Explanation                                                  |
  | ------------ | ------------- | ------------------------------------------------------------ |
  | empId        | String        | Employee ID                                                  |
  | empNo        | String        | Employee No, unique value, only letters and numbers, length 32 |
  | name         | String        | Developer accesses to the platform page to obtain            |
  | phone        | String        | Phone number                                                 |
  | orgId        | String        | Company ID                                                   |
  | mail         | String        | E-mail                                                       |
  | stageName    | String        | Stage name                                                   |
  | cardNo       | String        | IC card number                                               |
  | entryTime    | String        | Entry time: yyyy-MM-dd HH:mm:ss format                       |
  | workPlace    | String        | Working place                                                |
  | personTypeId | String        | Employee type ID                                             |
  | tel          | String        | Landline                                                     |
  | gender       | number(byte)  | Gender，dictionary [3.2](#3.2)                               |
  | idCardNo     | String        | ID card number                                               |
  | roleId       | String        | Role ID                                                      |
  | deptIdList   | array(string) | Department array ID list                                     |

### 4.4.4 Delete Personnel

* sdkRequestKey : `deletePerson`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation |
  | ---------- | ---------- | -------- | ----------- |
  | empId      | String     | Y        | Employee ID |

* Response parameter explanation: None

### 4.4.5 Generate Employee QR Code

* sdkRequestKey : `generateEmpQrCode`
* Request parameter explanation
  
  | Field Name | Field Type | Required | Explanation   |
  | -------- | -------- | -------- | ------ |
  | empId    | String   | Y        | 人员ID |
  | effectiveTimeType    | integer   | Y        | Type of validity 1: one month, 2: three months, 3: half a year, 4: one year, 5: permanent |

* Response parameter explanation

  | Field Name       | Field Type | Explanation                                                  |
  | ---------------- | ---------- | :----------------------------------------------------------- |
  | id               | String     | the QR Code ID                                               |
  | fileId           | String     | the QR Code file ID, Can be used to download QR code         |
  | qrCodeCreateTime | String     | QR code creation time yyyy-MM-dd HH:mm:ss                    |
  | qrCodeEndTime    | String     | Expiration date of QR code yyyy-MM-dd HH:mm:ss               |
  | effectiveType    | Integer    | QR code valid time type 1: one month, 2: three months, 3: half a year, 4: one year, 5: permanent |
  | qrCodeData       | String     | QR code content                                              |

## 4.5 Face API

### 4.5.1 Add Face

* sdkRequestKey : `addPersonFace`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation     |
  | ---------- | ---------- | -------- | --------------- |
  | empNo      | String     | Y        | Employee No     |
  | faceData   | byte[]     | Y        | Face byte array |

* Response parameter explanation

  | Field Name | Field Type | Explanation  |
  | ---------- | ---------- | ------------ |
  | None       | String     | the photo Id |

### 4.5.2 Delete Face

* sdkRequestKey : `deletePersonFace`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation |
  | ---------- | ---------- | -------- | ----------- |
  | empNo      | String     | Y        | Employee No |
  | photoId    | String     | Y        | Face ID     |

* Response parameter explanation：无

## 4.6 File API

### 4.6.1 Obtain Face

* sdkRequestKey : `getPersonFace`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation |
  | ---------- | ---------- | -------- | ----------- |
  | faceId     | String     | Y        | Face ID     |

* Response parameter explanation

  | Field Name | Field Type | Explanation     |
  | ---------- | ---------- | --------------- |
  | content    | byte[]     | Face byte array |

### 4.6.2 Obtain Image

* sdkRequestKey : `getImage`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation |
  | ---------- | ---------- | -------- | ----------- |
  | imageId    | String     | Y        | Image ID    |

* Response parameter explanation

  | Field Name | Field Type | Explanation      |
  | ---------- | ---------- | ---------------- |
  | content    | byte[]     | Image byte array |

## 4.7 Department API

> Group is actually a department

### 4.7.1 Add Department

* sdkRequestKey : `addPersonGroup`

* Request parameter explanation

  | Field Name      | Field Type   | Required | Explanation                                                  |
  | --------------- | ------------ | -------- | ------------------------------------------------------------ |
  | personGroupName | String       | Y        | Department name                                              |
  | parentGroupId   | String       | Y        | Department ID <br />If the parent department ID is empty, this department will be added to the system as the root department;<br />If the parent department ID is not empty and does not exist in the system (wrong ID), the Department will be set as the root department |
  | managerNos      | String array | Y        | Manager person NO array string list                          |

* Response parameter explanation

  | Field Name | Field Type | Explanation   |
  | ---------- | ---------- | ------------- |
  | None       | String     | Department ID |

### 4.7.2 Update Department

* sdkRequestKey : `updatePersonGroup`

* Request parameter explanation

  | Field Name      | Field Type   | Required | Explanation                                                  |
  | --------------- | ------------ | -------- | ------------------------------------------------------------ |
  | personGroupId   | String       | Y        | Department ID                                                |
  | personGroupName | String       | Y        | Department name                                              |
  | parentGroupId   | String       | N        | Department ID <br />If the parent department ID is empty, this department will be added to the system as the root department;<br />If the parent department ID is not empty and does not exist in the system (wrong ID), the Department will be set as the root department |
  | managerNos      | String array | N        | Manager person NO array  string list                         |

* Response parameter explanation: None

### 4.7.3 Query Department

* sdkRequestKey : `getPersonGroup`

* Request parameter explanation

  | Field Name    | Field Type | Required | Explanation   |
  | ------------- | ---------- | -------- | ------------- |
  | personGroupId | String     | Y        | Department ID |

* Response parameter explanation

  | Field Name      | Field Type   | Explanation            |
  | --------------- | ------------ | ---------------------- |
  | personGroupId   | String       | Department ID          |
  | personGroupName | String       | Department name        |
  | parentGroupId   | String       | Parent department ID   |
  | managerNos      | String array | Manager personNo array |

### 4.7.4 Delete Department

* sdkRequestKey : `getPersonGroup`

* Request parameter explanation

  | Field Name    | Field Type | Required | Explanation   |
  | ------------- | ---------- | -------- | ------------- |
  | personGroupId | String     | Y        | Department ID |

* Response parameter explanation：None

## 4.8 Role API

> The actual meaning of the role here is the personnel title and rank

### 4.8.1 Add Role

* sdkRequestKey : `addPersonRole`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation |
  | ---------- | ---------- | -------- | ----------- |
  | roleName   | String     | Y        | Role name   |

* Response parameter explanation

  | Field Name | Field Type | Explanation |
  | ---------- | ---------- | ----------- |
  | 无         | String     | Role ID     |

### 4.8.2 Update Role

* sdkRequestKey : `updatePersonRole`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation |
  | ---------- | ---------- | -------- | ----------- |
  | roleId     | String     | Y        | Role ID     |
  | roleName   | String     | Y        | Role name   |

* Response parameter explanation：None

### 4.8.3 Delete Role

* sdkRequestKey : `deletePersonRole`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation |
  | ---------- | ---------- | -------- | ----------- |
  | roleId     | String     | Y        | Role ID     |

* Response parameter explanation: 无

### 4.8.4 Query Role

* sdkRequestKey : `listAllPersonRoles`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation |
  | ---------- | ---------- | -------- | ----------- |
  | roleId     | String     | Y        | Role ID     |
  | roleName   | String     | Y        | Role name   |


* Response parameter explanation

  | Field Name | Field Type | Explanation |
  | ---------- | ---------- | ----------- |
  | roleId     | String     | Role ID     |
  | roleName   | String     | Role name   |

## 4.9 Personnel Type API

### 4.9.1 Add Personnel Type

* sdkRequestKey : `addPersonType`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation |
  | ---------- | ---------- | -------- | ----------- |
  | typeName   | String     | Y        | Type Name   |

* Response parameter explanation

  | Field Name | Field Type | Explanation |
  | ---------- | ---------- | ----------- |
  | 无         | String     | Type ID     |

### 4.9.2 Delete Personnel Type

* sdkRequestKey : `deletePersonRole`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation |
  | ---------- | ---------- | -------- | ----------- |
  | typeId     | String     | Y        | Type ID     |

* Response parameter explanation：无

### 4.9.3 Update Personnel Type

* sdkRequestKey : `updatePersonRole`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation |
  | ---------- | ---------- | -------- | ----------- |
  | typeId     | String     | Y        | Role ID     |
  | typeName   | String     | Y        | Role name   |

* Response parameter explanation：None

### 4.9.4 Query Personnel Type

* sdkRequestKey : `listAllPersonTypes`

* Request parameter explanation：None

* Response parameter explanation

* | Field Name | Field Type | Explanation         |
  | ---------- | ---------- | ------------------- |
  | typeId     | String     | Personnel type ID   |
  | typeName   | String     | Personnel type name |

## 4.10 Device API

### 4.10.1 Add Device

* sdkRequestKey : `addDevice`

* Request parameter explanation

  | Field Name    | Field Type | Required | Explanation                                       |
  | ------------- | ---------- | -------- | ------------------------------------------------- |
  | deviceName    | String     | Y        | Role ID                                           |
  | deviceIp      | String     | Y        | Role name                                         |
  | devicePass    | String     | Y        | Device password                                   |
  | deviceGroupId | String     | Y        | Device grouping ID                                |
  | lang          | String     | Y        | Device language（en（English） zh-CN（Chinese）） |


* Response parameter explanation

  | Field Name | Field Type | Explanation |
  | -------- | -------- | --------------------- |
  | None | String | device Key 设备序列号 |

### 4.10.2 Upgrade Device

* sdkRequestKey : `updateDevice`

* Request parameter explanation

  | Field Name    | Field Type | Required | Explanation                                       |
  | ------------- | ---------- | -------- | ------------------------------------------------- |
  | deviceName    | String     | Y        | Role ID                                           |
  | deviceIp      | String     | Y        | Role name                                         |
  | devicePass    | String     | Y        | Device password                                   |
  | deviceGroupId | String     | Y        | Device grouping ID                                |
  | lang          | String     | Y        | Device language（en（English） zh-CN（Chinese）） |
  | deviceKey     | String     | Y        | Device serial No                                  |


* Response parameter explanation：None

### 4.10.3 Delete Device

* sdkRequestKey : `forceDeleteDevice`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation      |
  | ---------- | ---------- | -------- | ---------------- |
  | deviceKey  | String     | Y        | Device serial No |

* Response parameter explanation：None

### 4.10.4 Query Device

* sdkRequestKey : `queryDevicePage`

* Request parameter explanation

  | Field Name       | Field Type   | Required | Explanation                                                  |
  | ---------------- | ------------ | -------- | ------------------------------------------------------------ |
  | pageNum          | Integer      | Y        | Page number                                                  |
  | pageSize         | Integer      | Y        | Page size                                                    |
  | deviceKey        | String       | N        | Device serial No.                                            |
  | deviceName       | String       | N        | Device name                                                  |
  | deviceIp         | String       | N        | Device IP                                                    |
  | deviceGroupId    | String       | N        | Device grouping ID                                           |
  | status           | number       | N        | Device status, refer to Data Dictionary [3.6](#3.6)          |
  | cardSupport      | Boolean      | N        | Whether cards are supported                                  |
  | recognitionModes | number array | N        | byte list <br />Recognition mode, refer to Dictionary Data [3.3](#3.3) |

* Response parameter explanation

  | Field Name      | Field Type   | Explanation                                |
  | --------------- | ------------ | ------------------------------------------ |
  | deviceKey       | String       | Device serial No.                          |
  | deviceName      | String       | Device name                                |
  | status          | number       | Device status, dictionary data [3.6](#3.6) |
  | enable          | Boolean      | Device enables Disable Status              |
  | expType         | expType      | Device exception type                      |
  | orgId           | String       | Company id                                 |
  | softwareVersion | String       | Device software version                    |
  | sdkVersion      | String       | Device algorithm version                   |
  | deviceIp        | String       | Device ip address                          |
  | recognitionMode | number array | Device recognition mode                    |
  | deviceGroupId   | String       | Device group ID                            |
  | deviceGroupName | String       | Device group name                          |
  | lang            | String       | Device language                            |
  | faceNum         | Integer      | Device face number                         |
  | personNum       | Integer      | Device personnel number                    |
  | cardSupport     | Boolean      | Whether the device supports cards          |

### 4.11.5 Query Single Device

* sdkRequestKey : `getDevice`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation       |
  | ---------- | ---------- | -------- | ----------------- |
  | deviceKey  | String     | Y        | Device serial No. |


* Response parameter explanation

  | Field Name      | Field Type   | Explanation                                |
  | --------------- | ------------ | ------------------------------------------ |
  | deviceKey       | String       | Device serial No.                          |
  | deviceName      | String       | Device name                                |
  | status          | number       | Device status, refer to Dictionary Data    |
  | enable          | Boolean      | Device status, dictionary data [3.6](#3.6) |
  | expType         | expType      | Device exception type                      |
  | orgId           | String       | Device Company id                          |
  | softwareVersion | String       | Device software version                    |
  | sdkVersion      | String       | Device algorithm version                   |
  | deviceIp        | String       | Device ip address                          |
  | recognitionMode | number array | Device recognition mode设                  |
  | deviceGroupId   | String       | Device group id                            |
  | deviceGroupName | String       | Device group name                          |
  | lang            | String       | Device language                            |
  | faceNum         | Integer      | Device face number                         |
  | personNum       | Integer      | Device personnel number                    |
  | cardSupport     | Boolean      | Whether the device supports cards          |

## 4.11 Device Grouping API

### 4.11.1 Add Device Grouping

* sdkRequestKey : `addDeviceGroup`

* Request parameter explanation

  | Field Name      | Field Type   | Required | Explanation       |
  | --------------- | ------------ | -------- | ----------------- |
  | deviceGroupName | String       | Y        | Device group name |
  | remark          | String       | N        | remark            |
  | deviceKeyList   | String array | N        | Device serial No. |

* Response parameter explanation

  | Field Name | Field Type | Explanation        |
  | ---------- | ---------- | ------------------ |
  | None       | String     | Device Grouping ID |

### 4.11.2 Delete Device Grouping

* sdkRequestKey : `deleteDeviceGroup`

* Request parameter explanation

  | Field Name    | Field Type | Required | Explanation     |
  | ------------- | ---------- | -------- | --------------- |
  | deviceGroupId | String     | Y        | Device group ID |

* Response parameter explanation: None

### 4.11.3 Update Device Grouping

* sdkRequestKey : `updateDeviceGroup`

* Request parameter explanation

  | Field Name      | Field Type   | Required | Explanation       |
  | --------------- | ------------ | -------- | ----------------- |
  | deviceGroupId   | String       | Y        | Device group id   |
  | deviceGroupName | String       | Y        | Device group name |
  | remark          | String       | N        | remark            |
  | deviceKeyList   | String array | N        | Device serial No. |

* Response parameter explanation：None

### 4.11.4 Query device grouping

* sdkRequestKey : `listAllDeviceGroup`

* Request parameter explanation：None

* Response parameter explanation

  | Field Name      | Field Type   | Explanation            |
  | --------------- | ------------ | ---------------------- |
  | deviceGroupId   | String       | Device grouping ID     |
  | deviceGroupName | String       | Name                   |
  | remark          | Integer      | Remark                 |
  | deviceNum       | String       | Device number          |
  | deviceKeyList   | String array | Device serial No. List |

## 4.12 Device Authorization API

### 4.12.1 Add Authorization

* sdkRequestKey : `addDeviceAuth`

* Request parameter explanation

  | Field Name            | Field Type   | Required | Explanation                                                  |
  | --------------------- | ------------ | -------- | ------------------------------------------------------------ |
  | empNo                 | String       | Y        | Employee No.                                                 |
  | deviceKey             | String       | Y        | Device serial No.                                            |
  | imgStoreDevice        | Boolean      | Y        | Whether to store the original image                          |
  | permissionStartTime   | Date         | N        | Permission start time: yyyy-MM-dd HH:mm:ss                   |
  | permissionEndTime     | Date         | N        | Permission end time: yyyy-MM-dd HH:mm:ss                     |
  | permissionTimeEntries | array        | N        | Permission timetable (up to six)                             |
  | -- startTime          | String       | N        | Start time: HH:mm                                            |
  | -- endTime            | String       | N        | End time: HH:mm                                              |
  | recognitionTypes      | number array | N        | Recognition mode: 1. Face 2. Card 3. Face-card-in-one 4. Face-card comparison |

* Response parameter explanation：None

### 4.12.2 Update Authorization

* sdkRequestKey : `updateDeviceAuthRequest`

* Request parameter explanation

  | Field Name            | Field Type   | Required | Explanation                                            |
  | --------------------- | ------------ | -------- | ------------------------------------------------------ |
  | empNo                 | String       | Y        | Employee No.                                           |
  | deviceKey             | String       | Y        | Device serial No.                                      |
  | imgStoreDevice        | Boolean      | Y        | Whether to store the original image                    |
  | permissionStartTime   | Date         | N        | Permission start time: yyyy-MM-dd HH:mm:ss             |
  | permissionEndTime     | Date         | N        | Permission end time: yyyy-MM-dd HH:mm:ss               |
  | permissionTimeEntries | array        | N        | Permission timetable (up to six)                       |
  | -- startTime          | String       | N        | Start time: HH:mm                                      |
  | -- endTime            | String       | N        | End Time: HH:mm                                        |
  | recognitionTypes      | number array | N        | Recognition mode, refer to Dictionary Data [3.3](#3.3) |

* Response parameter explanation：None

### 4.12.3 Delete Authorization

* sdkRequestKey : `deleteDeviceAuth`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation          |
  | ---------- | ---------- | -------- | -------------------- |
  | empNo      | String     | Y        | Employee No          |
  | deviceKey  | String     | Y        | Device serial number |

* Response parameter explanation：None

### 4.12.4 Query Authorization

* sdkRequestKey : `queryDeviceAuthPage`

* Request parameter explanation

  | Field Name    | Field Type | Required | Explanation             |
  | ------------- | ---------- | -------- | ----------------------- |
  | pageNum       | Integer    | Y        | Page No.                |
  | pageSize      | Integer    | Y        | Page Size               |
  | departmentId  | String     | N        | Department ID           |
  | empId         | String     | N        | Employee ID             |
  | empNo         | String     | N        | Employee No.            |
  | empName       | String     | N        | Employee Name           |
  | empTypeId     | String     | N        | Employee Type ID        |
  | cardNum       | String     | N        | Employee Card No.       |
  | deviceKey     | String     | N        | Device Serial Number    |
  | deviceName    | String     | N        | Device Name             |
  | deviceGroupId | String     | N        | Device Grouping Name id |

* Response parameter explanation

  | Field Name               | Field Type   | Explanation                                                  |
  | ------------------------ | ------------ | ------------------------------------------------------------ |
  | empNo                    | String       | Employee No.                                                 |
  | deviceKey                | String       | Device Serial No.                                            |
  | recModeTypes             | number array | Employee Permission Type                                     |
  | faces                    | object array | Employee-authorized face array                               |
  | -- faceId                | String       | Face ID                                                      |
  | -- photoId               | String       | Photo ID                                                     |
  | -- status                | number       | Photo Authorization Status <br />1：Authorizing<br />2：Authorization completed <br />3：Authorization failed<br />4：Removing authorization <br />5：Remove successfully <br />6：Remove unsuccessfully |
  | -- photoUrl              | String       | Photo path                                                   |
  | -- failedReason          | String       | Failure reason                                               |
  | permissionTime           | Object       | Employee time permission                                     |
  | -- permissionStartTime   | Date         | Permissions start time: yyyy-MM-dd HH:mm:ss                  |
  | -- permissionEndTime     | Date         | Permissions end time:  yyyy-MM-dd HH:mm:ss                   |
  | -- permissionTimeEntries | Object       | Permission timetable setting object                          |
  | -- -- startTime          | String       | Start time:HH:mm                                             |
  | -- -- endTime            | String       | End time: HH:mm                                              |

## 4.13 Device Search Discovery

### 4.13.1 Start Searching for Devices

* sdkRequestKey : `startSearchDevice`

* Request parameter explanation：None

* Response parameter explanation：None

### 4.13.2  Device Search Results

* sdkRequestKey : `getDeviceSearchTask`

* Request parameter explanation: None

* ![img](file:///C:\Users\jingmu\AppData\Local\Temp\ksohtml\wpsBF1B.tmp.png)Response parameter explanation

  | Field Name      | Field Type | Explanation                                        |
  | --------------- | ---------- | -------------------------------------------------- |
  | deviceKey       | String     | Device serial No.                                  |
  | deviceName      | String     | Device name                                        |
  | deviceGroupName | String     | Device grouping name                               |
  | softwareVersion | String     | Software version number of device firmware         |
  | ip              | String     | ip                                                 |
  | alreadyExist    | Boolean    | Whether it already exists on UStar                 |
  | hasPassword     | Boolean    | Whether the device has a password                  |
  | dhcp            | Boolean    | Whether the device network is configured with DHCP |

## 4.14 Attendance Report API

### 4.14.1 Attendance Details Report

* sdkRequestKey : `atdDetailReport`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation                    |
  | ---------- | ---------- | -------- | ------------------------------ |
  | pageNum    | Integer    | Y        | Page number                    |
  | pageSize   | Integer    | Y        | Limit number of items per page |
  | deptId     | String     | N        | Department ID                  |
  | empName    | String     | N        | Department Name/Number         |
  | startDate  | date       | N        | Start date: yyyy-MM-dd         |
  | endDate    | date       | N        | End date: yyyy-MM-dd           |

* Response parameter explanation

  | Field Name             | Field Type   | Explanation                                                  |
  | ---------------------- | ------------ | ------------------------------------------------------------ |
  | personId               | String       | Personnel ID                                                 |
  | personNo               | String       | Employee No                                                  |
  | name                   | String       | Employee Name                                                |
  | depNames               | String array | Department Name Array                                        |
  | roleNames              | String array | Position Name Array                                          |
  | atDate                 | date         | Date: yyyy-MM-dd                                             |
  | timeIntervalName       | String       | Timetable Name                                               |
  | planSignInDatetime     | Date         | Planned clock-in time: yyyy-MM-dd HH:mm:ss                   |
  | planSignOutDatetime    | Date         | Planned clock-out time: yyyy-MM-dd HH:mm:ss                  |
  | planTimeIntervalSecond | long number  | Planned working time period, in seconds                      |
  | realSignInTime         | Date         | Actual clock-in time: yyyy-MM-dd HH:mm:ss                    |
  | signInStatus           | number       | Clock-in status: 1. Normal; <br />2. Not clocked-in; <br />3. Late;<br />4. Early;<br />5. Not clock-in yet; <br />6. Overtime |
  | realSignOutTime        | date         | Actual clock-out time: yyyy-MM-dd HH:mm:ss                   |
  | signOutStatus          | number       | Clock-in status: 1. Normal; <br />2. Not clocked-in; <br />3. Late;<br />4. Early;<br />5. Not clock-in yet; <br />6. Overtime |
  | realWorkTimeSecond     | long number  | Actual working time, in seconds                              |
  | normalWorkSecond       | long number  | Normal working time, in second                               |
  | realLateSecond         | long number  | Late time, in seconds                                        |
  | realLeaveEarlySecond   | long number  | Early time, in seconds                                       |
  | realAbsenteeismSecond  | long number  | Absence Time, in seconds                                     |
  | workDayOverWorkSecond  | long number  | Workday Overtime, in seconds                                 |
  | restDayOverWorkSecond  | long number  | Weekend Overtime, in seconds                                 |
  | holidayOverWorkSecond  | long number  | Holiday Overtime, in seconds                                 |
  | dateType               | number       | Date type, Dictionary data [3.5](#3.5)                       |
  | signInStart            | Date         | Start clock-in time, which has a value if and only if dateType=2 |
  | signInEnd              | Date         | End clock-in time, which has a value if and only if dateType=2 |

### 4.14.2 Time Attendance Report

* sdkRequestKey : `atdOverWorkReport`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation                    |
  | ---------- | ---------- | -------- | ------------------------------ |
  | pageNum    | Integer    | Y        | Page Number                    |
  | pageSize   | Integer    | Y        | Limit number of items per page |
  | deptId     | String     | N        | Department ID                  |
  | empName    | String     | N        | Department Name/Number         |
  | startDate  | date       | N        | Start Date: yyyy-MM-dd开       |
  | endDate    | date       | N        | End Date: yyyy-MM-dd           |

* Response parameter explanation

  | Field Name            | Field Type   | Explanation                                     |
  | --------------------- | ------------ | ----------------------------------------------- |
  | personId              | String       | Employee ID                                     |
  | personNo              | String       | Employee No                                     |
  | name                  | String       | Employee Name                                   |
  | depNames              | String array | Department Name Array                           |
  | roleNames             | String array | Position Name Array                             |
  | atDate                | date         | Date: yyyy-MM-dd                                |
  | workDayOverWorkSecond | long number  | Workday Overtime, in seconds                    |
  | restDayOverWorkSecond | long number  | Weekend Overtime, in seconds                    |
  | holidayOverWorkSecond | long number  | Holiday Overtime, in seconds                    |
  | dateType              | number       | Date type, refer to Dictionary Data [3.5](#3.5) |

### 4.14.3 Attendance Rest Report

* sdkRequestKey : `atdBreakTimeReport`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation                    |
  | ---------- | ---------- | -------- | ------------------------------ |
  | pageNum    | Integer    | Y        | Page Number                    |
  | pageSize   | Integer    | Y        | Limit number of items per page |
  | deptId     | String     | N        | Department ID                  |
  | empName    | String     | N        | Department Name/No             |
  | startDate  | date       | N        | Start Date: yyyy-MM-dd         |
  | endDate    | date       | N        | End Date: yyyy-MM-dd           |

* Response parameter explanation

  | Field Name            | Field Type   | Explanation                                         |
  | --------------------- | ------------ | --------------------------------------------------- |
  | personId              | String       | Employee ID                                         |
  | personNo              | String       | Employee No                                         |
  | name                  | String       | Employee Name                                       |
  | depNames              | String array | Department Name Array                               |
  | roleNames             | String array | Position Name Array                                 |
  | atDate                | date         | Date: yyyy-MM-dd                                    |
  | timeIntervalName      | String       | Timetable Name                                      |
  | breaktimeName          | String       | Rest Timetable Name                                 |
  | planBreakTimeDuration | long number  | Planned Rest Time, in seconds                       |
  | realBreakTimeStart    | Date         | Actual Rest Start Time: yyyy-MM-dd                  |
  | realBreakTimeEnd      | Date         | Actual Rest End Time: yyyy-MM-dd                    |
  | realBreakTimeDuration | long number  | Actual rest time, in seconds                        |
  | breakStatus           | number       | Rest Status：0-Not calculated，1-Normal，2-Abnormal |

### 4.14.4  Abnormal Clock-in Report

* sdkRequestKey : `atdExceptionReport`

* Request parameter explanation

  | Field Name | Field Type | Required | Explanation                    |
  | ---------- | ---------- | -------- | ------------------------------ |
  | pageNum    | Integer    | Y        | Page Number                    |
  | pageSize   | Integer    | Y        | Limit number of items per page |
  | deptId     | String     | N        | Department ID                  |
  | empName    | String     | N        | Department Name/Number         |
  | startDate  | date       | N        | Start Date: yyyy-MM-dd         |
  | endDate    | date       | N        | End Date: yyyy-MM-dd           |

* Response parameter explanation

  | Field Name      | Field Type   | Explanation                        |
  | --------------- | ------------ | ---------------------------------- |
  | personId        | String       | Employee ID                        |
  | personNo        | String       | Employee No                        |
  | name            | String       | Employee Name                      |
  | depNames        | String array | Department Name Array              |
  | roleNames       | String array | Position Name Array                |
  | atDate          | date         | Date: yyyy-MM-dd                   |
  | recognitionTime | Date         | Clock-in time: yyyy-MM-dd HH:mm:ss |
  | clockPhotoId    | String       | Clock photo ID卡图片Id             |
  | deviceKey       | String       | Device Key                         |
  | deviceName      | String       | Device name                        |

# 5 Event Subscription Callback

> The Manager logs in to the Ustar client and sets the callback address and mattered events of the docking platform on the developer docking platform page.
>
> The Ustar client system monitors these events internally and sends the information of these events as they occur to the docking platform that has followed them.
>
> If the message sending fails due to network reasons, the system will retry the sending, and the maximum number of retries is 20, with an interval of 5 minutes each time.

## 5.1 Event Message Structure Explanation

* Request Method：`POST`

* Request Header ：`Content-Type: application/json`

* Request Body：

  | Field Name | Field Type   | Explanation                                                  |
  | ---------- | ------------ | ------------------------------------------------------------ |
  | msgId      | String       | Message id                                                   |
  | type       | number(byte) | java byte typeMessage type, refer to the data dictionary for detailsjava byte [3.4](#3.4) |
  | content    | String       | The message content is json string of the event callback content |

* Response body content:

  | Field Name | Field Type | Explanation                                                  |
  | ---------- | ---------- | ------------------------------------------------------------ |
  | success    | boolean    | Whether received successfully<br />If `true` is returned, the system will no longer process the message<br />If `false` is returned, the system will retry after 5 minutes |

> **Note 1：The response data is required to be returned in JSON format**
>
> **Note 2: When processing a system callback message, the message is processed successfully only if it returns a successful return result correctly, otherwise the system will keep retrying.**
>
> **Note 3: The consumer needs to do idempotence control.**
>
> **Note 4: Event Message Push sends the data as HTTP, the request does not contain permissions and authentication information.**

## 5.2 Callback Event

### 5.2.1 Recognition Record Callback Event

* Trigger condition: when the device recognition record is called back to the system

* Event callback content:

  | Field Name         | Field Type    | Explanation                                                  |
  | ------------------ | ------------- | ------------------------------------------------------------ |
  | recordId           | String        | Recognition record id                                        |
  | empNo              | String        | Recognition Employee No                                      |
  | recMode            | number        | Recognition mode, refer to Dictionary Data [3.3](#3.3)       |
  | deviceKey          | String        | Recognition Device serial No.                                |
  | deviceName         | String        | Device name                                                  |
  | recTime            | Date          | Recognition time: yyyy-MM-dd HH:mm:ss                        |
  | orgId              | String        | Team id                                                      |
  | temperature        | double number | Real-time body temperature                                   |
  | imageId            | String        | Image id                                                     |
  | temperatureState   | number        | Body temperature status <br />1：Normal<br />2：Abnormal<br />3：Not set<br />4：Body temperature not measured<br />null: Body temperature not measured |
  | temperatureUnit    | number        | Body temperature unit <br />1：Celsius <br />2：Fahrenheit   |
  | aliveBody          | number        | Live detection <br />1：Live<br />2：Non-live<br />3：Not detected |
  | permissionTimeType | number        | Permission time judgment <br />1:Within the permission time<br />2:Not within the permission time<br />3:Not set |
  | passTimeType       | number        | Permission date judgment <br />1:Within the permission date<br />2:Not within the permission date<br />3:Not set |
  | identifyType       | number        | success compare person <br /> 1 success<br />2 failed<br />3 No comparison|
  | aliveBody          | number        | alive body result<br /> 1 alive body <br />2 not alive body <br />3 No living judgment was performed |

### 5.2.2 Employee Add Event

* Trigger condition: trigger when a new employee is added

* Event callback content

  | Field Name    | Field Type   | Explanation                                   |
  | ------------- | ------------ | --------------------------------------------- |
  | empId         | String       | Employee id                                   |
  | empNo         | String       | Employee No                                   |
  | name          | String       | Employee  name                                |
  | phone         | String       | Mobile phone                                  |
  | ~~workNo~~    | String       | Employee No                                   |
  | orgId         | String       | Team id                                       |
  | mail          | String       | E-mail                                        |
  | stageName     | String       | Stage name                                    |
  | cardNo        | String       | Card number                                   |
  | entryTime     | Date         | Entry time: yyyy-MM-dd HH:mm:ss               |
  | workPlace     | String       | Working place                                 |
  | ~~empTypeId~~ | String       | Personnel type id                             |
  | tel           | String       | Landline                                      |
  | gender        | number       | Gender， refer to Dictionary Data [3.2](#3.2) |
  | faceIdList    | String array | Face array id                                 |
  | photoIds      | String array | Face array id                                 |
  | deptIdList    | String array | Department array id                           |

### 5.2.3 Employee Change Event

* Trigger condition: trigger when the system has an employee update

* Event callback content:

  | Field Name    | Field Type   | Explanation                                  |
  | ------------- | ------------ | -------------------------------------------- |
  | empId         | String       | Employee id                                  |
  | empNo         | String       | Employee No                                  |
  | name          | String       | Employee name                                |
  | phone         | String       | Mobile phone                                 |
  | ~~workNo~~    | String       | Work No                                      |
  | orgId         | String       | Team id                                      |
  | mail          | String       | E-mail                                       |
  | stageName     | String       | Stage name                                   |
  | cardNo        | String       | Card number                                  |
  | entryTime     | Date         | Entry time: yyyy-MM-dd HH:mm:ss              |
  | workPlace     | String       | Working place                                |
  | ~~empTypeId~~ | String       | Employee type id                             |
  | tel           | String       | Landline                                     |
  | gender        | number       | Gender, refer to dictionary data [3.2](#3.2) |
  | faceIdList    | String array | Face array id                                |
  | photoIds      | String array | Face array id                                |
  | deptIdList    | String array | Department array id                          |

### 5.2.4 Employee Delete Event

* Trigger condition: trigger when an employee is deleted
* Event callback content:

  | Field Name  | Field Type   | Explanation                |
  | ----------- | ------------ | -------------------------- |
  | orgId       | String       | Company id                 |
  | employeeNos | String array | Deleted Employee No. array |

### 5.2.5 Department Add Event

* Trigger condition: trigger when a department is added

* Event callback content:

  | Field Name  | Field Type   | Explanation                  |
  | ----------- | ------------ | ---------------------------- |
  | depId       | String array | Face array id                |
  | depName     | String array | Department array id          |
  | parentDepId | String       | Parent Department ID         |
  | orgId       | String       | Company id                   |
  | order       | String       | Department sorting           |
  | rootDep     | boolean      | Is it the root department    |
  | managerNos  | String array | Department manager No. array |

### 5.2.6 Department Update Event

* Trigger condition: trigger when a department is updated

* Event callback content

  | Field Name  | Field Type   | Explanation                  |
  | ----------- | ------------ | ---------------------------- |
  | depId       | String array | Face array id                |
  | depName     | String array | Department array id          |
  | parentDepId | String       | Parent department ID         |
  | orgId       | String       | Company id                   |
  | order       | String       | Department sorting           |
  | rootDep     | boolean      | Is it the root department    |
  | managerNos  | String array | Department manager No. array |

### 5.2.7 Department Delete Event

* Trigger condition: trigger when a department is updated

* Event callback content:

  | Field Name | Field Type   | Explanation                 |
  | ---------- | ------------ | --------------------------- |
  | deptIdList | String array | Deleted Department ID array |
